(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a84348f0"],{"42f3":function(t,e,a){},4450:function(t,e,a){"use strict";a("9bd3")},"5a3b":function(t,e,a){},"6b79":function(t,e,a){"use strict";a.d(e,"a",(function(){return r}));a("106c");var r={methods:{formatTime:function(t){var e="-";try{e=new Date(1e3*t);var a=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),l=e.getHours(),s=e.getMinutes(),n=e.getSeconds(),i="".concat(a,"-").concat(r,"-").concat(o," ").concat(l,":").concat(s,":").concat(n);return i}catch(c){console.log(c)}return e}}}},"70f5":function(t,e,a){"use strict";a("5a3b")},"9bd3":function(t,e,a){},a744:function(t,e,a){"use strict";a("42f3")},ae8d:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"card"},[t.title?a("div",{staticClass:"card-head"},[t._v(" "+t._s(t.title)+" "),a("div",{staticStyle:{float:"right"}},[t._t("op")],2)]):t._e(),t._t("default")],2)},o=[],l={name:"Card",props:{title:{type:String,default:""}}},s=l,n=(a("70f5"),a("838c")),i=Object(n["a"])(s,r,o,!1,null,"e0fb135e",null);e["a"]=i.exports},fec0:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":t.beforeEnter,enter:t.animEnter}},[a("Mine",{key:"0",attrs:{"data-index":"0"}}),a("Applications",{key:"2",attrs:{"data-index":"0.3"}}),a("Approvals",{key:"1",attrs:{"data-index":"0.5"}}),a("History",{key:"3",attrs:{"data-index":"0.6"}})],1)},o=[],l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{attrs:{title:"我的属性"},scopedSlots:t._u([{key:"op",fn:function(){return[a("el-input",{attrs:{size:"medium",placeholder:"请输入要声明的属性"},model:{value:t.newAttr,callback:function(e){t.newAttr=e},expression:"newAttr"}},[a("el-button",{attrs:{slot:"append"},on:{click:t.generateAttr},slot:"append"},[t._v("声明新属性")])],1)]},proxy:!0}])},[t.APKMap?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.getAttributes(t.APKMap)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"属性名"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"属性公钥"}})],1)],1):a("el-empty",{attrs:{"image-size":100,description:"还没有属性"}})],1)},s=[],n=a("cc39"),i=(a("1a55"),a("bdf9"),a("106c"),a("ae8d")),c=a("07a4"),u=a("63e0"),p={name:"Mine",components:{Card:i["a"]},computed:Object(n["a"])({},c["a"].mapUser(["APKMap"])),data:function(){return{newAttr:""}},methods:{getAttributes:function(t){for(var e=[],a=0,r=Object.keys(t);a<r.length;a++){var o=r[a];e.push({name:o,value:t[o].Gy})}return e},generateAttr:function(){var t=this,e=c["a"].properties(["name","password"]),a=e.name,r="".concat(a,":").concat(this.newAttr);u["a"].generate({name:a,attr:r}).then((function(){t.$message({message:"创建成功",duration:2e3,type:"success"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))}}},m=p,f=a("838c"),d=Object(f["a"])(m,l,s,!1,null,null,null),b=d.exports,v=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Card",{attrs:{title:"历史记录"}},[t.records.length?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.records}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"uid",label:"当前用户"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"fromUid",label:"操作用户"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"attrName",label:"属性名称"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"operation",label:"操作"}}),a("el-table-column",{attrs:{sortable:"",prop:"timeStamp",label:"操作时间"}})],1)],1):a("el-empty",{attrs:{"image-size":100,description:"还没有记录"}})],1)},g=[],h=a("6b79"),y=a("f8ce"),w={name:"History",components:{Card:i["a"]},mixins:[h["a"]],data:function(){return{records:[]}},methods:{},mounted:function(){var t=this,e=c["a"].userName();y["a"].history(e).then((function(e){t.records=e}))}},k=w,_=Object(f["a"])(k,v,g,!1,null,null,null),A=_.exports,x=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",{attrs:{title:"属性审批"}},[t.attributes.length?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.attributes}},[a("el-table-column",{attrs:{prop:"isPublic",label:"",width:"50"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.isPublic?"公开":"私有")+" ")]}}],null,!1,2581177575)}),a("el-table-column",{attrs:{prop:"status",label:"类型",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(e.row.applyType)+" ")]}}],null,!1,4286698161)}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"attrName",label:"属性名"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"fromUid",label:"申请人"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"remark",label:"申请备注"}}),a("el-table-column",{attrs:{label:"操作",width:"250"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"warning"},on:{click:function(a){return t.revoke(e.row)}}},[t._v(" 撤销 ")]),a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){return t.agree(e.row,!0)}}},[t._v(" 同意 ")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.agree(e.row,!1)}}},[t._v(" 拒绝 ")])]}}],null,!1,2738409261)}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"100",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t.statusTypes[e.row.status],size:"small"}},[t._v(" "+t._s(e.row.status)+" ")])]}}],null,!1,3402781693)})],1)],1):a("el-empty",{attrs:{"image-size":100,description:"暂无待审批的属性"}})],1),a("el-dialog",{attrs:{title:"属性审批",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.approval}},[t._v("确 定")])],1)],1)],1)},$=[],F=(a("2646"),a("0721"),a("7fa7"),a("042e"),a("ee64"),{name:"Approvals",components:{Card:i["a"]},mounted:function(){var t=this,e=c["a"].properties(["OPKMap","name"]),a=e.OPKMap,r=e.name,o=[{to:r,role:0}];Object.keys(a).map((function(t){o.push({to:t,role:1})}));var l="ALL",s=[];Promise.all(o.map((function(t){var e=t.to,a=t.role;return y["a"].applications({to:e,role:a,status:l})}))).then((function(e){e.forEach((function(t){s=s.concat(t)})),t.attributes=s})).catch(console.log)},data:function(){return{attributes:[],form:{remark:""},params:{},dialogFormVisible:!1,statusTypes:{SUCCESS:"success",FAIL:"danger",PENDING:"info"}}},methods:{agree:function(t,e){var a=c["a"].userName(),r=t.attrName,o=t.fromUid;this.params={to:o,agree:e,attr:r,user:a},this.dialogFormVisible=!0},approval:function(){var t=this;y["a"].approval(Object(n["a"])(Object(n["a"])({},this.params),this.form)).then((function(){t.$message({message:"审批成功",duration:2e3,type:"success"})})).catch((function(e){t.$message({message:e.message,duration:2e3,type:"error"})})).finally((function(){t.dialogFormVisible=!1}))},revoke:function(t){var e=this,a=c["a"].userName(),r=t.attrName,o=t.fromUid;y["a"].revoke({userName:a,toUserName:o,attrName:r}).then((function(){e.$message({message:"撤销成功",duration:2e3,type:"success"})})).catch((function(t){e.$message({message:t.message,duration:2e3,type:"error"})}))}}}),S=F,O=Object(f["a"])(S,x,$,!1,null,null,null),C=O.exports,j=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("Card",{attrs:{title:"属性授权"},scopedSlots:t._u([{key:"op",fn:function(){return[a("el-button",{attrs:{slot:"append",size:"small"},on:{click:t.syncApplications},slot:"append"},[t._v(" 同步属性 ")]),a("el-button",{attrs:{slot:"append",size:"small",type:"primary"},on:{click:function(e){t.dialogFormVisible=!0}},slot:"append"},[t._v(" 申请属性 ")])]},proxy:!0}])},[t.appliedAttrMap?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.formatAttributes(t.appliedAttrMap)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"属性名"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"属性公钥"}})],1)],1):a("el-empty",{attrs:{"image-size":100,description:"没有正在申请的属性"}})],1),a("el-dialog",{attrs:{title:"申请属性",visible:t.dialogFormVisible},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"applyForm",attrs:{rules:t.applyRules,model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"attr",label:"属性名"}},[a("el-input",{model:{value:t.form.attr,callback:function(e){t.$set(t.form,"attr",e)},expression:"form.attr"}})],1),a("el-form-item",{attrs:{label:"属性类型"}},[a("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入用户或组织名"},model:{value:t.form.belongs,callback:function(e){t.$set(t.form,"belongs",e)},expression:"form.belongs"}},[a("el-select",{attrs:{slot:"prepend",placeholder:"请选择"},slot:"prepend",model:{value:t.form.role,callback:function(e){t.$set(t.form,"role",e)},expression:"form.role"}},[a("el-option",{attrs:{label:"用户属性",value:"to"}}),a("el-option",{attrs:{label:"组织属性",value:"org"}})],1)],1)],1),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.applyForAttr}},[t._v("确 定")])],1)],1)],1)},E=[],M={name:"Applications",components:{Card:i["a"]},computed:Object(n["a"])({},c["a"].mapUser(["appliedAttrMap"])),mounted:function(){},data:function(){return{attributes:[],statusTypes:{"已通过":"success","被拒绝":"danger","未处理":"info"},dialogFormVisible:!1,form:{attr:"",to:"",org:"",belongs:"",role:"to",remark:""},applyRules:{attr:[{required:!0,trigger:"blur",message:"属性名不能为空"}]}}},methods:{formatAttributes:function(t){for(var e=[],a=0,r=Object.keys(t);a<r.length;a++){var o=r[a];e.push({name:o,value:t[o]})}return e},applyForAttr:function(){var t=this,e=c["a"].properties(["name"]),a=e.name;a&&this.$refs.applyForm.validate((function(e){if(e){var r={to:"",org:""},o=t.form,l=o.remark,s=o.role,i=o.belongs;r[s]=i;var c="".concat(i,":").concat(t.form.attr);y["a"].apply(Object(n["a"])({attr:c,name:a,remark:l},r)).then((function(){t.$message({message:"申请成功",duration:2e3,type:"success"})})).catch((function(e){t.$message({message:e.message,type:"error"})})).finally((function(){t.dialogFormVisible=!1}))}}))},syncApplications:function(){var t=this;u["a"].sync().then((function(){t.$message({message:"同步成功",duration:2e3,type:"success"})})).catch((function(e){t.$message({message:e.message,type:"error"})}))}}},N=M,V=(a("a744"),Object(f["a"])(N,j,E,!1,null,null,null)),z=V.exports,P={name:"Attributes",components:{Mine:b,History:A,Approvals:C,Applications:z},data:function(){return{attributes:[]}},methods:{beforeEnter:function(t){t.dataset.index>-1&&(t.style.opacity=.5,t.style.transform="translateX(30px)")},animEnter:function(t,e){var a=250*t.dataset.index;setTimeout((function(){t.style="",e()}),a)}}},U=P,T=(a("4450"),Object(f["a"])(U,r,o,!1,null,"6ffe5a46",null));e["default"]=T.exports}}]);
//# sourceMappingURL=chunk-a84348f0.418de5c7.js.map