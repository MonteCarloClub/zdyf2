(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e39fcb6c"],{2616:function(e,t,a){"use strict";a("3f1a")},"2a32":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));a("0721");var r=a("b775"),o={create:function(e){var t={fileName:e.userName,t:e.threshold,n:e.usersNum,users:e.users,orgName:e.orgName};return new Promise((function(e,a){Object(r["a"])({url:"/org/apply/creation",method:"post",data:t}).then((function(t){200===t.code?e(t.data):a(t)})).catch(a)}))},join:function(e){var t=e.userName,a=e.orgName,o={fileName:t,orgName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/creation/approval",method:"post",data:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},submitppk:function(e){var t=e.orgName,a=e.userName,o={type:"CREATION",orgName:t,fileName:a,attrName:""};return new Promise((function(e,t){Object(r["a"])({url:"/org/part-pk",method:"post",params:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},submitOrgAttppk:function(e){var t=e.orgName,a=e.userName,o=e.attrName,n={type:"ATTRIBUTE",orgName:t,fileName:a,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/part-pk",method:"post",params:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},completeOrg:function(e){var t=e.orgName,a=e.userName,r={type:"CREATION",orgName:t,userName:a,attrName:""};return this.complete(r)},completeOrgAttr:function(e){var t=e.orgName,a=e.userName,r=e.attrName;return this.complete({type:"ATTRIBUTE",orgName:t,userName:a,attrName:r})},complete:function(e){var t=e.type,a=e.orgName,o=e.userName,n=e.attrName,i={type:t,orgName:a,fileName:o,attrName:n};return new Promise((function(e,t){Object(r["a"])({url:"/org/complete-pk",method:"post",params:i}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},tempOrgInfo:function(e){var t=e.orgName,a={type:"CREATION",orgName:t,attrName:""};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply",method:"get",params:a}).then((function(a){200===a.code?e(a.data):t(a)})).catch((function(e){e?console.log(e):t(e)}))}))},tempOrgAttrInfo:function(e){var t=e.orgName,a=e.attrName,o={type:"ATTRIBUTE",orgName:t,attrName:a};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply",method:"get",params:o}).then((function(a){200===a.code?e(a.data):t(a)})).catch((function(e){e?console.log(e):t(e)}))}))},detailInfo:function(e){var t=e.orgName,a={orgName:t};return new Promise((function(e,t){Object(r["a"])({url:"/org/",method:"get",params:a}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},declareAttr:function(e){var t=e.orgName,a=e.userName,o=e.attrName,n={orgName:t,fileName:a,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/attribute",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))},approvalAttr:function(e){var t=e.userName,a=e.orgName,o=e.attrName,n={fileName:t,orgName:a,attrName:o};return new Promise((function(e,t){Object(r["a"])({url:"/org/apply/attribute/approval",method:"post",data:n}).then((function(a){200===a.code?e(a.data):t(a)})).catch(t)}))}}},"3f1a":function(e,t,a){},"477a":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("transition-group",{staticClass:"grid-rows",attrs:{tag:"div",appear:""},on:{"before-enter":e.beforeEnter,enter:e.animEnter}},[a("Mine",{key:"0",attrs:{"data-index":"0"}})],1)},o=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("Card",{attrs:{title:"我的组织"},scopedSlots:e._u([{key:"op",fn:function(){return[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.joinDialogFormVisible=!0}}},[e._v(" 加入组织 ")]),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.applyDialogFormVisible=!0}}},[e._v(" 申请创建组织 ")])]},proxy:!0}])},[e.OPKMap?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.formatOrganization(e.OPKMap)}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"name",label:"组织名称",width:"180"}}),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"value",label:"组织公钥"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.value||"暂无")+" ")]}}],null,!1,508938292)}),a("el-table-column",{attrs:{label:"操作",width:"160",align:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.submitPartPK(t.row)}}},[e._v(" 提交组织秘密 ")])]}}],null,!1,3126450051)})],1)],1):a("el-empty",{attrs:{"image-size":100,description:"没有正在申请的属性"}})],1),a("el-dialog",{attrs:{title:"申请成立新组织",visible:e.applyDialogFormVisible},on:{"update:visible":function(t){e.applyDialogFormVisible=t}}},[a("el-form",{ref:"applyForm",attrs:{rules:e.applyRules,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"orgName",label:"组织名称"}},[a("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.form.orgName,callback:function(t){e.$set(e.form,"orgName",t)},expression:"form.orgName"}})],1),a("el-form-item",{attrs:{prop:"threshold",label:"阈值"}},[a("el-input",{attrs:{placeholder:"请输入阈值"},model:{value:e.form.threshold,callback:function(t){e.$set(e.form,"threshold",t)},expression:"form.threshold"}})],1),a("el-form-item",{attrs:{prop:"userStr",label:"其它成员"}},[a("el-input",{attrs:{placeholder:"请输入除您之外包含的其它成员"},model:{value:e.form.userStr,callback:function(t){e.$set(e.form,"userStr",t)},expression:"form.userStr"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.applyDialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.applyForOrg}},[e._v("确 定")])],1)],1),a("el-dialog",{attrs:{title:"加入组织",visible:e.joinDialogFormVisible},on:{"update:visible":function(t){e.joinDialogFormVisible=t}}},[a("el-form",{ref:"joinForm",attrs:{rules:e.joinRules,model:e.joinForm,"label-width":"80px"}},[a("el-form-item",{attrs:{prop:"orgName",label:"组织名称"}},[a("el-input",{attrs:{placeholder:"请输入组织名称"},model:{value:e.joinForm.orgName,callback:function(t){e.$set(e.joinForm,"orgName",t)},expression:"joinForm.orgName"}})],1)],1),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.joinDialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.joinOrg}},[e._v("确 定")])],1)],1)],1)},i=[],s=a("cc39"),l=(a("1a55"),a("ac30"),a("f6a5"),a("0721"),a("8281"),a("bdf9"),a("ae8d")),m=a("2a32"),u=a("07a4"),c={name:"Mine",components:{Card:l["a"]},computed:Object(s["a"])({},u["a"].mapUser(["OPKMap"])),data:function(){return{applyDialogFormVisible:!1,form:{threshold:"",userStr:"",orgName:""},applyRules:{orgName:[{required:!0,trigger:"blur",message:"组织名不能为空"}],threshold:[{required:!0,trigger:"blur",message:"阈值不能为空"}],userStr:[{required:!0,trigger:"blur",message:"成员不能为空"}]},joinDialogFormVisible:!1,joinForm:{orgName:""},joinRules:{orgName:[{required:!0,trigger:"blur",message:"组织名不能为空"}]}}},methods:{formatOrganization:function(e){for(var t=[],a=0,r=Object.keys(e);a<r.length;a++){var o=r[a];t.push({name:o,value:e[o].OPK})}return t},applyForOrg:function(){var e=this,t=u["a"].userName();t&&this.$refs.applyForm.validate((function(a){if(a){var r=e.form,o=r.threshold,n=r.userStr,i=r.orgName,s=n.split(" ");s.push(t),m["a"].create({userName:t,threshold:o,users:s,orgName:i,usersNum:s.length}).then((function(){e.$message({message:"申请成功",duration:2e3,type:"success"})})).catch((function(t){e.$message({message:t.message,type:"error"})})).finally((function(){e.applyDialogFormVisible=!1}))}}))},joinOrg:function(){var e=this,t=u["a"].userName();t&&this.$refs.joinForm.validate((function(a){if(a){var r=e.joinForm.orgName;m["a"].join({userName:t,orgName:r}).then((function(){e.$message({message:"加入成功",duration:2e3,type:"success"})})).catch((function(t){e.$message({message:t.message,type:"error"})})).finally((function(){e.applyDialogFormVisible=!1}))}}))},submitPartPK:function(e){var t=this,a=u["a"].userName();m["a"].submitppk({userName:a,orgName:e.name}).then((function(){t.$message({message:"提交成功",duration:2e3,type:"success"}),t.trycompleteOrgPK(a,e.name)})).catch((function(e){t.$message({message:e.message,type:"error"})}))},trycompleteOrgPK:function(e,t){var a=this;m["a"].completeOrg({userName:e,orgName:t}).then((function(){a.$message({message:"组织已确认创建",duration:2e3,type:"success"})})).catch(console.log)}}},p=c,f=a("838c"),g=Object(f["a"])(p,n,i,!1,null,null,null),d=g.exports,h={name:"Organizations",components:{Mine:d},data:function(){return{attributes:[]}},methods:{beforeEnter:function(e){e.dataset.index>-1&&(e.style.opacity=.5,e.style.transform="translateX(30px)")},animEnter:function(e,t){var a=250*e.dataset.index;setTimeout((function(){e.style="",t()}),a)}}},N=h,b=(a("2616"),Object(f["a"])(N,r,o,!1,null,"7108c15b",null));t["default"]=b.exports},"5a3b":function(e,t,a){},"70f5":function(e,t,a){"use strict";a("5a3b")},ae8d:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"card"},[e.title?a("div",{staticClass:"card-head"},[e._v(" "+e._s(e.title)+" "),a("div",{staticStyle:{float:"right"}},[e._t("op")],2)]):e._e(),e._t("default")],2)},o=[],n={name:"Card",props:{title:{type:String,default:""}}},i=n,s=(a("70f5"),a("838c")),l=Object(s["a"])(i,r,o,!1,null,"e0fb135e",null);t["a"]=l.exports}}]);
//# sourceMappingURL=chunk-e39fcb6c.4cc32d5c.js.map